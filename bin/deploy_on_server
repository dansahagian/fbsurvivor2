#!/bin/zsh

echo "Stopping services..."
sudo systemctl stop wsgi-server.service
sudo systemctl stop celeryworker.service
sudo systemctl stop celerybeat.service

echo "Deploying..."
cd /opt/fbsurvivor2
git pull origin main
venv/bin/pip install --upgrade pip
venv/bin/pip install -r ./requirements/base.txt

venv/bin/python manage.py clearcache
venv/bin/python manage.py migrate
venv/bin/python manage.py collectstatic --no-input
venv/bin/python manage.py check --deploy
venv/bin/python manage.py updatecache

echo "Starting services..."
sudo systemctl start wsgi-server.service
sudo systemctl start celeryworker.service
sudo systemctl start celerybeat.service
